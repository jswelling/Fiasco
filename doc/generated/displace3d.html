# $Id: displace3d.c,v 1.8 2006/10/23 20:59:57 welling Exp $
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>displace3d_help</title>
  </head>
  <body>
    <h1>displace3d_help</h1>
<h2>Introduction</h2>
<pre>

  displace3d takes a file of the format output by estireg3d.c 
  and, for each set of registration parameters, calculates
  the overall rotation in degrees, the translation distance of
  the center, and the mean distance that a voxel is displaced
  for the given registration.

  To run displace use:
    displace3d [-estimates Output-parameter-file]
             [-xdimension xExtent] [-ydimension yExtent] 
      [-zdimension zExtent] [-weight Weight-file]
             -xvoxel xvx -yvoxel yvx -zvoxel zvx
             [-filtered] [-debug] infile

  or:
    displace -help
 

</pre>
<h2>Arguments</h2>
<h3>estimates</h3>
<pre>
   [-estimates Output-parameter-file]    (-est Output-parameter-file)

   Ex: -e displaceParam.par

   Specifies that the displacement statistics should be written
   to Output-parameter-file. Default is "displace3d.par".

   Displacement statistics are scalar, floating-point numbers.
   These are written in ASCII in the format:

     t   angle   transdist   meandisp

   where t is the image number, angle is the rotation angle in
   degrees,  transdist is the translation of the center, and meandisp
   is the mean displacement of all the voxels in the image.  Distances
   are given in the same units as the input voxel sizes;  that is, if
   -xvoxel and etc. are given in mm then the distances will be in mm.


</pre>
<h3>xdimension</h3>
<pre>
   [-xdimension xExtent]                       (-xdm xExtent)

   Ex: -xdm 64

   Specifies the extent of the x-dimension, xExtent, over which to
   calculate the mean displacement.  Either this argument or 
   a weight file (see below) must be present.

</pre>
<h3>ydimension</h3>
<pre>
   [-ydimension yExtent]                       (-ydm yExtent)

   Ex: -ydm 32

   Specifies the extent of the y-dimension, yExtent, over which to
   calculate the mean displacement. Either this argument or 
   a weight file (see below) must be present.

</pre>
<h3>zdimension</h3>
<pre>
   [-zdimension zExtent]                       (-zdm zExtent)

   Ex: -zdm 14

   Specifies the extent of the z-dimension, zExtent, over which to
   calculate the mean displacement.  Either this argument or 
   a weight file (see below) must be present.

</pre>
<h3>xvoxel</h3>
<pre>
   -xvoxel xv                      (-xvx xv)

   Specifies the voxel edge length in the x direction.  This
   parameter is required.  

</pre>
<h3>yvoxel</h3>
<pre>
   -yvoxel yv                      (-yvx yv)

   Specifies the voxel edge length in the y direction.  This
   parameter is required.  

</pre>
<h3>zvoxel</h3>
<pre>
   -zvoxel zv                      (-zvx zv)

   Specifies the voxel edge length in the z direction.  This
   parameter is required.

</pre>
<h3>weight</h3>
<pre>
   -weight Weight-file             (-wgt|w Weight-file)

   Specifies a file of relative weights to be used when summing the
   displacements of the voxels.  This is a Pittsburgh MRI file the
   first dimensions of which must be (v)xyz .  If a v dimension is
   present, its extent must be 1.  The first image from this file is
   used to weight the voxel displacements.  For example, one might
   use the data mean or a mask of the brain to weight displacements.
   Either a weight file or the -x, -y, and -z flags must be given.
   If the -x, -y, or -z flags are given, their arguments must agree
   with the dimensions of any weight dataset;  if they are not given
   the corresponding dimensions of the weight dataset are used.  The
   default weight is of course 1.0.

</pre>
<h3>filtered</h3>
<pre>
   -filtered			(-ftd)

   Specifies that the output parameter data should be labeled as 
   being "filtered" rather than "raw".  This affects only the way
   the output values are displayed in time series viewers (for
   example ParViewer).

</pre>
<h3>debug</h3>
<pre>
   -debug

   Causes debugging information to be written to stderr.

</pre>
<h3>infile</h3>
<pre>

   Ex: Registration-parameter-file

   Specifies that the registration parameters are to be read
   from Registration-parameter-file. This argument is required.

   Specifies that the motion correction parameters are to be
   written to Registration-parameter-file. Default value is "reg3d.par".

   The format of the Registration-parameter-file is a series of
   ASCII numbers of the form generated by estireg3d, that is:

         image# q_x q_y q_z q_w shift_x shift_y shift_z mse

   where the q_ elements compose a unit quaternion specifying
   the rotation.  These 9 numbers must be separated by spaces
   or tabs, but NOT carriage returns- all nine numbers must reside
   on the same line.  The mse entry is ignored;  it is given for
   compatibility with other utilities.  Lines beginning with '#'
   are considered to be comments and are ignored.

</pre>
<h2>Details</h2>
<h3>Calculation</h3>
<pre>

   Each line of input registration parameters provides a quaternion
   (defining a rotation) and x, y, and z displacements.  The
   convention shared by all Fiasco 3D alignment software is that
   rotations are applied before displacements.  

   The output translation of the center is simply the magnitude of 
   given displacement vector.  The rotation information is supplied
   directly by the quaternion, which is equivalent to an angle-axis
   representation of the rotation.

   The rotation translates each voxel by some distance.  Those
   distances are multiplied by the weight for that voxel (or 1.0)
   if no weight dataset is given) and summed, and the sum is divided
   by the total weight.   The known translation  is added.  The 
   resulting displacement is the weighted average displacement of 
   all the voxels in the given image under the given registration
   parameters.



</pre>
    <hr>
    (automatically generated by displace3d_help version of Sat Jan  2 22:50:37 2010)
  </body>
</html>
