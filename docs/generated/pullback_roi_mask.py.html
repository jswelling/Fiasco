<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>pullback_roi_mask.py</title>
  </head>
  <body>
    <h1>pullback_roi_mask.py</h1>
<h2>Overview</h2>
<pre>

  pullback_roi_mask.py takes a mask defined in Talairach space and
  the information in a standard Fiasco subject directory, and finds
  the corresponding mask in the subject's original un-normalized
  space.

   pullback_roi_mask.py [-v][-d] --srcdir directoryName 
     [--thresh voxCountThresh]  [--strippedthresh brainTissueThreshold]
     inMaskDS outMaskDS

  where
    -v specifies verbose output
    -d specifies debugging output
    --srcdir directoryName specifies the directory path to
      a Fiasco directory for the subject in question.  This directory
      must contain the 'stat', 'anat', and 'generated_scripts' 
      subdirectories with their usual contents.  This field is required.
    --thresh voxCountThresh specifies the number of Talairach ROI voxels
      within the given unnormalized voxel for it to be considered
      to lie within the unnormalized ROI.  The default is 1.0.
    --strippedthresh brainTissueThreshold specifies the minimum value
      of the stripped anatomical image considered to lie within the
      brain.  The default is 1.0.
    inMaskDS is an input mask dataset in Talairach space.  All voxel
      values in the file must be either 0.0 or 1.0.
    outMaskDS is the name of the output unnormalized mask to be
      created.  This dataset will contain voxels with values equal to
      0.0 or 1.0.

  or

   pullback_roi_mask.py -help [topic]

</pre>
<h2>Details</h2>
<pre>

  The algorithm requires that the following files exist in the
  input directory: 

    stat/GrandMean.mri dataset
    normalized_anat/norm_stripped_axial dataset, or
      anat/stripped_axial
    generated_scripts/apply_coreg_inplane.gen_csh
    generated_scripts/apply_coreg_struct_to_inplane.gen_csh
    generated_scripts/apply_cowarp_inplane.gen_csh
    generated_scripts/apply_normalize.gen_csh

  if the norm_stripped_axial dataset does not exist, it is created
  from the stripped_axial dataset using the generated scripts.

  The algorithm proceeds as follows.  

  - In Talairach space, a mask is constructed by taking the
    intersection of the set of voxels in the input ROI mask 
    inMaskDS with the value 1 and the set of voxels in the 
    subject's norm_stripped_axial dataset with values greater 
    than or equal to the --strippedthresh value.

  - An address volume is constructed in unnormalized space by
    filling each voxel with that voxel's offset within the file.
    This volume is then normalized using the generated scripts,
    producing an address volume in Talairach space filled with
    corresponding offset values in the unnormalized space volume.
    'Nearest neighbor' resampling is used in this normalization,
    so that the address values are preserved.

  - The 'pullback' utility is used to sum the voxels in the
    intersection mask (which have values 0 or 1) into the
    unnormalized space voxels at the corresponding addresses
    in the Talairach space address file.

  - Because Talairach voxels are much smaller than unnormalized 
    voxels, a variable number of Talairach mask voxels may overlap 
    the Talairach'd version of an unnormalized mask.  The pulled-
    back dataset constructed above thus has voxel values ranging
    from 0 to approximately 40, depending on the details of the
    normalizing transformation.  If an unnormalized voxel contains
    a number of normalized mask voxels at least equal to the 
    --thresh value, its value is 1 in the output ROI mask.

</pre>
    <hr>
    (automatically generated by pullback_roi_mask.py version of Mon Jul 15 00:18:47 2019)
  </body>
</html>
