# $Id: smregpar3d.c,v 1.13 2007/07/30 18:35:48 welling Exp $
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>smregpar3d_help</title>
  </head>
  <body>
    <h1>smregpar3d_help</h1>
<h2>Overview</h2>
<pre>

  smregpar3d smooths registration parameters generated by estireg3d .
  The results are written to a parameter file, which is in turn used
  to register image data.  In addition, an imagewisewise table of median 
  MSE and inter-quartile range values is written to standard output.

  smregpar3d [-headerinput Input-header-file]
             [-parameterin Registration-parameter-file]
             [-parameterout Output-parameter-file] 
             [-cutoff Num-MSE-IQRs] [-fixed Fixed-image-number]
             [-bandwidth N] [-kernel Kernel-type]
             [-threshold Change-point-threshold] [...smoother options...]

  smregpar -help [topic]

  Command Line Options (see Usage:flag)

  -help   Engage help system, providing help on topic, if supplied,
            or starting the interactive help system otherwise.

</pre>
<h2>Usage</h2>
<h3>headerinput</h3>
<pre>

  -headerinput Input-header-file        (-h Input-header-file)

     Specifies that the header for the input dataset is located
       in Input-header-file.
     Default value is "input.mri".

     smregpar accepts only standard images, and dimensions t and
       z are required.

</pre>
<h3>parameterin</h3>
<pre>

  -parameterin Registration-parameter-file

     Specifies that the registration parameters are to be read
       from Registration-parameter-file.
     Default value is "reg3d.par".

     The format of the Registration-parameter-file is a series of
     ASCII numbers of the form:
       image# q_x q_y q_z q_w shift_x shift_y shift_z mse
     where the q_ elements compose a unit quaternion specifying
     the rotation.  These 9 numbers must be separated by spaces
     or tabs, but NOT carriage returns- all nine numbers must reside
     on the same line.  Lines beginning with '#' are considered to be 
     comments and are ignored.  This matches the file format written
     by estireg3d.

</pre>
<h3>parameterout</h3>
<pre>

  -parameterout Output-parameter-file

     Specifies that the smoothed registration parameters are to
       be written to Output-parameter-file.
     Default value is "smreg3d.par".

     The format of the Output-parameter-file is a series of
     ASCII numbers of the form:
       image# q_x q_y q_z q_w shift_x shift_y shift_z mse
     where the q_ elements compose a unit quaternion specifying
     the rotation.  These 9 numbers must be separated by spaces
     or tabs, but NOT carriage returns- all nine numbers must reside
     on the same line.  The mse entry is unchanged from its value
     on input.  Lines beginning with '#' are considered to be comments 
     and are ignored.

</pre>
<h3>cutoff</h3>
<pre>

  -cutoff Num-MSE-IQRs                  (-c Num-MSE-IQRs)

     Specifies the minimum number of interquartile ranges (IQRs)
       that the mean-squared error (MSE) value (the value used by
       estireg.c in determining the fit of the registration) must
       be from the median MSE in order for the image to be considered
       an outlier.  
     Images which are considered outliers are declared to be missing.
     Default value is 10.0.

</pre>
<h3>fixed</h3>
<pre>

  -fixed Fixed-image-number             (-f Fixed-image-number)

     Specifies that the image numbered Fixed-image-number is the
       image to which the others were registered.  If all slices
       of this image are missing, the next image is used.  If that
       image is completely missing the process repeats.
     The registration parameters for the fixed image remain
       unchanged, and the MSE for that image is not used in
       calculating the median and IQR of the MSEs.
     Default value is -1.

     Note: If Fixed-image-number falls outside the range of
       viable image numbers, it is simply ignored and no image
       is given special treatment.

</pre>
<h3>kernel</h3>
<pre>

  -kernel Kernel-type                   (-k Kernel-type)

     Specifies that a Kernel-type function will be convolved with the
       registration parameters to produce the smoothed parameters.
     Acceptable values of Kernel-type are "gaussian", "triangular",
       and "exponential".  "exponential" corresponds to a power law
       smoother;  see below.
     Default is "gaussian".

</pre>
<h3>bandwidth</h3>
<pre>

  -bandwidth val                          (-b val)

     Specifies the bandwidth of the smoothing function.  See the
     description of the smoother parameters below.
     Default value is 3.0.

</pre>
<h3>threshold</h3>
<pre>

  -threshold Change-point-threshold     (-t Change-point-threshold)

     Specifies that registration parameters that are more than a
       Euclidean distance of Change-point-threshold apart are
       considered to be too far apart to be smoothed together.
     Any such points are considered change-points (with respect
       each other) and all points further distant in that direction
       are also ignored in the smoothing for that point.
     Registration parameters are scaled before calculating Euclidean
       distance.  Translations are left at scale but rotations are
       scaled by: ( X-extent * X-extent + Y-extent * Y-extent ) / 3.0.
     This Euclidean distance is a measure of the mean squared distance
       that a pixel is displaced by the registration.
     Default value is 0.01.

</pre>
<h3>SmootherOptions</h3>
<pre>

    -smoother_type type

       type specifies smoother type. Available options are:

              "gauss" for Gaussian kernel smoothing
              "tri"   for triangular kernel smoothing
              "pow"   for power law kernel smoothing 
              "median"for median smoothing
              "none"  to disable smoothing  
              "ddx"   a special type which produces output values equal 
                      to the change in the input from the previous sample
              "shift" a special type which produces output values equal 
                      to the input values at some nearby cell
              "linterp" a special type which produces output values which
                      are linearly interpolated between adjacent inputs
              "runningsum" a special type which produces output values equal 
                      to the previous output value plus the
                      corresponding input value

    -smoother_bandwidth band

       band (a floating point number) specifies the bandwidth used
            in smoothing.  The meaning of bandwidth depends on the
            type of smoothing used;  see below.

    -smoother_threshold thresh

       thresh (a floating point number) specifies the cutoff threshold
            for the smoothing kernel.  If a point within the smoothing
            window differs from the point being calculated by a value
            greater than the threshold, the window is truncated before
            that value on that side.  If thresh is &lt;= 0.0, this test
            is not performed and the window is not truncated.

    -smoother_k k

       k (a floating point number) specifies a constant which may be
            used in specifying the smoothing kernel.  No current 
            smoother type actually uses this value; it is present for
            future expansion.

  Unless otherwise specified for a specific function, the default type
  is Gaussian, the default bandwidth is 45.0, the default constant is 
  60.0, and the default threshold is 0.0.

</pre>
<h2>Calculation</h2>
<pre>

  Smoothing is done separately for each parameter, by convolving a 
    kernel function with the sequence of parameters.  For the 
    quaternion values representing the rotation information, this
    amounts to smoothing in full 4-D quaternion space.  These four
    values are then rescaled to produce a unit quaternion.

  However, it is important to avoid over-smoothing in the presence of
    change-points.  Thus, a measure of the mean-squared distance that
    a pixel is displaced between registrations is obtained.  If this
    measure is too large between points s and t, then the parameters
    associated all time points before s will not be used in calculating
    the smoothed estimate for time t.  Note that this measure is not
    calculated separately for each parameter, but incorporates them all.

  This executable also marks images missing in its output based on
    the mean squared error of the alignment calculation.  (This value
    is available along with the alignment parameters).  The algorithm
    is as follows.  First, the MSE value time series is smoothed,
    using the same kernel and cutoffs described above.  This provides
    an expectation of the MSE at each time point.  The median and 
    IQR of the various MSE values for the slice around this point
    are calculated, and times for which the MSE falls outside the
    outlier cutoff set by the "cutoff" option are marked missing.
    The values for the other alignment parameters are then smoothed,
    excluding the slices just marked missing (and any other missing
    slices).

</pre>
<h2>SmootherCalculation</h2>
<pre>

  All kernel smoothers check for missing data points, and exclude them. 

  Kernel smoothers perform the following operations at each point
  to be smoothed.  First, a smoothing window is defined.  This
  window initially includes all of the data points.  The window is 
  then truncated using the threshold value if appropriate.  A weighted
  sum of the points remaining in the window is then calculated,
  excluding missing points.  This value is divided by the sum of the 
  weights to produce the smoothed value for the point in question.
 
  The weights used are defined by the kernel K(t), where t= x1-x2, the
  separation between the points in question.  The kernels used by the
  various kernel smoothers are:

  Gaussian:   K(t)= exp( -(t*t)/(bandwidth*bandwidth) ) 


                    1.0 - (abs(t)/bandwidth) if abs(t)&lt;=bandwidth/2
  Triangular: K(t)= 
                    0.0 otherwise
                    

  Power law:  K(t)= pow( C, abs(t) )  where C= pow(0.5,1/bandwidth), 
                                      so that bandwidth is full width
                                      at half maximum.

  Smoother type "median" replaces the input value with the median
  value in a window of total width equal to bandwidth.  "median"
  k values but respects thresholds.

  Smoother type "none" does no smoothing, simply copying its input to
  its output.

  Smoother type "ddx" produces output Y[i]= X[i]-X[i-1].  This is a
  convenient hack when derivatives are needed.  "ddx" ignores
  bandwidth, threshold, k, and all "missing" information.

  Smoother type "shift" produces output Y[i]= X[i+shift], where 
  shift=rint(bandwidth).  (rint rounds to the nearest integer).
  Values for which X[i+shift] would fall outside the range of the
  input data are set to 0.0.  "shift" ignores threshold, k, and all
  "missing" information.

  Smoother type "linterp" produces output Y[i]= (X[i-1] + X[i+1])/2
  for all i which do not lie on the boundary of the input data range.
  At the boundaries, 2-point extrapolative values are used.  For
  example, Y[0]= 2*X[1] - X[2].

  Smoother type "runningsum" produces output Y[0]= X[0], and
  Y[i]= Y[i-1]+X[i] for all i&gt;0.



</pre>
    <hr>
    (automatically generated by smregpar3d_help version of Sat Jul 13 21:46:00 2019)
  </body>
</html>
