# $Id: deghost.c,v 1.26 2007/03/21 23:46:16 welling Exp $
<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>deghost_help</title>
  </head>
  <body>
    <h1>deghost_help</h1>
<h2>Introduction</h2>
<pre>

  deghost is used to reduce ghosting effects in images

  To run deghost use:
    deghost [-input Input-header-file] [-headerout Output-Header-File]
            [-dataout Output-data-file] [-parameters RawParameter-File]
            [-smoothedparameters Parameter-File] [-phase Shift]
            [-mode estimate|apply|both]
            [-reverse even|odd|all|none] [...smoother options...]

  or:
    deghost -help 

  
</pre>
<h2>Arguments</h2>
<h3>input</h3>
<pre>
   [-input Input-header-file]        (-i Input-header-file)

   Ex: -i detrend

   Specifies that the header file for the input dataset is
   Input-header-file.  Default value is "input.mri". Input-header-file
   is not allowed to have the same name as Output-header-file.

   deghost accepts only standard complex-valued images with
   dimension order "vxy(z)(t)" or "vqy(z)(t)" as input.

</pre>
<h3>headerout</h3>
<pre>
   [-headerout Output-header-file]   (-h Output-header-file)

   Ex: -h deghostData

   Specifies that the header for the output dataset should be written
   to Output-header-file.  Default value is "deghost.mri".
   Output-header-file is not allowed to have the same name  as
   Input-header-file.  If -mode is "estimate" this file is never
   created.

</pre>
<h3>dataout</h3>
<pre>
   [-dataout Output-data-file]       (-d Output-data-file)

   Ex: -d deghostDataout

   Specifies that the output data should be written to Output-data-file.
   Default value is the value of headerout with ".dat" as its file
   extension. 

   The output dataset will consist of single-precision, complex-valued,
   floating-point numbers.

</pre>
<h3>parameters</h3>
<pre>
   [-parameters RawParameter-file]     (-pa RawParameter-file)

   Ex: -pa deghostParam

   Specifies that the unsmoothed phase shift parameters should be written
   to RawParameter-file.
   Default is "deghost.par".

</pre>
<h3>smoothedparameters</h3>
<pre>
   [-smoothedparameters Parameter-file]  (-sm Parameter-file)

   Ex: -sm deghostSmoothed

   Specifies that the smoothed phase shift parameters should be written
   to Parameter-file. Default is "deghost.smoothed.par".  NOTE that if
   the "-mode apply" flag is set (see below) this data is read
   rather than written.  The format of the parameter file is the
   same whether it is read or written.

</pre>
<h3>mode</h3>
<pre>
   [-mode estimate|apply|both]

   This option selects the operations that will be performed,
   as follows:  

   + If "estimate" is specified, parameters will be estimated and 
     smoothed and written to the appropriate parameter files.  

   + If "apply" is specified, phase estimates for each slice at each
     time will be READ from the smoothed parameters file rather than
     written to it.  When this option is set, the raw parameters file
     is never opened and no phase estimates are calculated; estimates
     generated by some other program are read from the parameter file.

   + If "both" is specified, parameter estimates are generated and
     immediatly applied.  Thus running with mode "both" is equivalent
     to running with mode "estimate" and then running with "apply".

   If the mode is not specified, it default to "both".

   The format of the parameter files are the same whether they are 
   read or written, which means that one run of "deghost" can generate
   parameters to be read by another run.

</pre>
<h3>phase</h3>
<pre>
   [-phase Shift]                         (-ph Shift)

   Ex: -ph 5       Ex: -ph byslice

   Specifies value or method of finding values for phase shift.

   + If Shift is a number, then Shift is the phase shift that
     is used for all slices of all images.  Phases will not be 
     estimated or read from a parameter file.
   + If Shift is "byslice", then a separate phase shift will be
     estimated and/or applied for each slice. 
     
   Default value is "byslice".

</pre>
<h3>reverse</h3>
<pre>
   [-reverse even|odd|all|none]    (-r even|odd|all|none)

   Ex: -r odd

   Specifies whether even, odd, all, or no scan lines are to be
   reversed before performing the FFT used to find optimal phase
   shifts.  This option is useful in dealing with deghosting before
   the scan lines (reversed as they come off the scanner) have been
   straightened out.   The default is to use any row flipping 
   information provided in the input dataset, or "none" if that
   information is unavailable.

</pre>
<h2>Details</h2>
<h3>Calculation</h3>
<pre>

  deghost applies a phase shift to each line (in the x-direction)
    of complex valued images.  The phase shift is of the same
    magnitude but of opposite sign for even and odd lines.
  deghost estimates the best phase shift by finding the phase
    shift which minimizes the magnitude of the middle three quarters
    (in the x-direction) of the top-most and bottom-most three lines 
    (in the y-direction), areas of the image which are typically 
    dominated by "ghosts."
  If the phase shift is estimated separately for each slice, then
    the average of the phase shift estimates for the first four
    images for each slice is used.
  If the phase shift is estimated just once for all images, then
    the average of the phase shift estimates for the first two
    images of all of the slices is used.

</pre>
<h3>FFTAlgorithm</h3>
<pre>

  The FFTW package (available from http://www.fftw.org/) is
  used to implement the fast Fourier transforms used in this routine.
  FFTW (Fastest Fourier Transform in the West) is distributed under
  the Gnu General Public License.

</pre>
<h3>FFTEnvironment</h3>
<pre>

  If the environment variable F_WISDOM_FILE is set, its value will be
  used as the basis for the name of a file in which FFTW will store
  "wisdom".  This is machine-specific information about what precise
  FFT algorithm is fastest on the specific hardware.  This information
  can then be reused, saving a couple of seconds the next time a
  program using FFTW runs.

  Because this information is machine specific, an architecture-
  specific string (usually the same as $PVM_ARCH) is appended to
  the value of F_WISDOM_FILE in forming the filename.

  In parallel runs, FFTW will create one wisdom file per processor,
  by appending processor numbers to the file name.  This is necessary
  to avoid errors due to multiple processes reading and writing the same
  file.


    
</pre>
<h2>Usage</h2>
<h3>SmootherOptions</h3>
<pre>

    -smoother_type type

       type specifies smoother type. Available options are:

              "gauss" for Gaussian kernel smoothing
              "tri"   for triangular kernel smoothing
              "pow"   for power law kernel smoothing 
              "median"for median smoothing
              "none"  to disable smoothing  
              "ddx"   a special type which produces output values equal 
                      to the change in the input from the previous sample
              "shift" a special type which produces output values equal 
                      to the input values at some nearby cell
              "linterp" a special type which produces output values which
                      are linearly interpolated between adjacent inputs
              "runningsum" a special type which produces output values equal 
                      to the previous output value plus the
                      corresponding input value

    -smoother_bandwidth band

       band (a floating point number) specifies the bandwidth used
            in smoothing.  The meaning of bandwidth depends on the
            type of smoothing used;  see below.

    -smoother_threshold thresh

       thresh (a floating point number) specifies the cutoff threshold
            for the smoothing kernel.  If a point within the smoothing
            window differs from the point being calculated by a value
            greater than the threshold, the window is truncated before
            that value on that side.  If thresh is &lt;= 0.0, this test
            is not performed and the window is not truncated.

    -smoother_k k

       k (a floating point number) specifies a constant which may be
            used in specifying the smoothing kernel.  No current 
            smoother type actually uses this value; it is present for
            future expansion.

  Unless otherwise specified for a specific function, the default type
  is Gaussian, the default bandwidth is 45.0, the default constant is 
  60.0, and the default threshold is 0.0.

</pre>
<h2>SmootherCalculation</h2>
<pre>

  All kernel smoothers check for missing data points, and exclude them. 

  Kernel smoothers perform the following operations at each point
  to be smoothed.  First, a smoothing window is defined.  This
  window initially includes all of the data points.  The window is 
  then truncated using the threshold value if appropriate.  A weighted
  sum of the points remaining in the window is then calculated,
  excluding missing points.  This value is divided by the sum of the 
  weights to produce the smoothed value for the point in question.
 
  The weights used are defined by the kernel K(t), where t= x1-x2, the
  separation between the points in question.  The kernels used by the
  various kernel smoothers are:

  Gaussian:   K(t)= exp( -(t*t)/(bandwidth*bandwidth) ) 


                    1.0 - (abs(t)/bandwidth) if abs(t)&lt;=bandwidth/2
  Triangular: K(t)= 
                    0.0 otherwise
                    

  Power law:  K(t)= pow( C, abs(t) )  where C= pow(0.5,1/bandwidth), 
                                      so that bandwidth is full width
                                      at half maximum.

  Smoother type "median" replaces the input value with the median
  value in a window of total width equal to bandwidth.  "median"
  k values but respects thresholds.

  Smoother type "none" does no smoothing, simply copying its input to
  its output.

  Smoother type "ddx" produces output Y[i]= X[i]-X[i-1].  This is a
  convenient hack when derivatives are needed.  "ddx" ignores
  bandwidth, threshold, k, and all "missing" information.

  Smoother type "shift" produces output Y[i]= X[i+shift], where 
  shift=rint(bandwidth).  (rint rounds to the nearest integer).
  Values for which X[i+shift] would fall outside the range of the
  input data are set to 0.0.  "shift" ignores threshold, k, and all
  "missing" information.

  Smoother type "linterp" produces output Y[i]= (X[i-1] + X[i+1])/2
  for all i which do not lie on the boundary of the input data range.
  At the boundaries, 2-point extrapolative values are used.  For
  example, Y[0]= 2*X[1] - X[2].

  Smoother type "runningsum" produces output Y[0]= X[0], and
  Y[i]= Y[i-1]+X[i] for all i&gt;0.



</pre>
    <hr>
    (automatically generated by deghost_help version of Sat Jul 13 21:45:47 2019)
  </body>
</html>
